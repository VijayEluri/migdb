import builder_rdb_link;
modeltype RDB uses "http://www.collectionspro.eu/jam/mm/rdb";
transformation addschema(out inoutModel : RDB);


main() {
	log("TEST_RDB");
	log("op: ADDNOTNULL");	
	
	var column : RDB::Column := _column("col", RDB::PrimitiveType::char);
	var columnFK : RDB::Column := _column("cizi", RDB::PrimitiveType::int);
	var columnUQ : RDB::Column := _column("uniq", RDB::PrimitiveType::char);
	var index : RDB::Index := _index("IX_col_first", OrderedSet{column});
	var table : RDB::Table := _table("first", OrderedSet{column, columnFK, columnUQ});
	var pk : RDB::PrimaryKey := _primaryKey("PK_first", column);
	table.constraints += pk;
	
	
	var column2 : RDB::Column := _column("id_second", RDB::PrimitiveType::int);	
	var table2 : RDB::Table := _table("second", OrderedSet{column2});
	var pk2 : RDB::PrimaryKey := _primaryKey("PK_second", column2);
	table2.constraints += pk2;
	
	var fk : RDB::ForeignKey := _foreignKey("FK_first_second", table2, columnFK);
	table.constraints += fk;

	var uq : RDB::Unique := _unique("UQ_uniq", columnUQ);
	table.constraints += uq;
	
	var model : RDB::ModelRoot := object ModelRoot {
		modelGenerations += object ModelGeneration {
			isMissing := false;
			schemas := Set{_schema("public", OrderedSet{table, table2}, _sequence("seq_global", 1), OrderedSet{index})};
		};
	};
	
	model.operations += _addNotNull("public", "first", "uniq", "NN_uniq");
}