module migbb.testing.orm.run.tests_orm

import org.eclipse.emf.mwe.utils.*
import org.eclipse.xtext.mwe.*


import org.eclipse.xtext.mwe.SlotEntry
//import org.eclipse.xtext.mwe.ResourceLoadingSlotEntry
import org.eclipse.xtext.mwe.Validator
import org.eclipse.xtext.mwe.NameBasedFilter

import org.eclipse.emf.mwe.utils.Writer
import org.eclipse.emf.mwe.utils.Reader

import eu.collectionspro.mwe.*
import migdb.generator.*

var QVTO_DIR = "../migdb.qvto/transforms"
var OUTPUT_BASE_DIR = "output-tests/orm_atomic"
var IN_APP_OPS = "${QVTO_DIR}/tests/operations/app"
var IN_APP_STR = "${QVTO_DIR}/tests/structures/app"
var COMPARE_ERRORS_DIR = "${QVTO_DIR}/tests/errors"
var COMPARISONS_STRUCTURES_DIR = "${QVTO_DIR}/tests/comparisons_orm_atomic"
var TEST_TRANSFORMATION = "${QVTO_DIR}/main/orm_run.qvto"

Workflow{	
/***** DEFINE META-MODELS *****/
/**/
	bean=org.eclipse.emf.mwe.utils.StandaloneSetup {
		platformUri=".."
		registerGeneratedEPackage = "mm.app.AppPackage"
	}
/**/
	bean=org.eclipse.emf.mwe.utils.StandaloneSetup {
		platformUri=".."
		registerGeneratedEPackage = "mm.rdb.RdbPackage"
	}
/**/
	bean=org.eclipse.emf.mwe.utils.StandaloneSetup {
		platformUri=".."
		registerGeneratedEPackage = "mm.errors.ErrorsPackage"
	}		

/***** CLEAN DIRECTORIES [XMI] *****/
/**/
	component = org.eclipse.emf.mwe.utils.DirectoryCleaner {
		directory = "${OUTPUT_BASE_DIR}"
	}

/***** MAIN TESTING *****/

/***** EXTRACT CLASS *****/
/**/
	component = TestComponent{
		transformationFile = "${TEST_TRANSFORMATION}"
		outputParentUri = "${OUTPUT_BASE_DIR}/1_extractClass"
		qvtInput = "${IN_APP_OPS}/extractClass_ops.qvto"
		qvtInput = "${IN_APP_STR}/extractClass_str.qvto"
		qvtComparison = "${COMPARISONS_STRUCTURES_DIR}/extractClass_required.qvto"
		qvtComparison = "${COMPARE_ERRORS_DIR}/empty_errors.qvto"
		testDescription = "extractClass"
	}
/**/
	component = TestComponent{
		transformationFile = "${TEST_TRANSFORMATION}"
		outputParentUri = "${OUTPUT_BASE_DIR}/2_moveProperty"
		qvtInput = "${IN_APP_OPS}/moveProperty_ops.qvto"
		qvtInput = "${IN_APP_STR}/moveProperty_str.qvto"
		qvtComparison = "${COMPARISONS_STRUCTURES_DIR}/moveProperty_required.qvto"
		qvtComparison = "${COMPARE_ERRORS_DIR}/empty_errors.qvto"
		testDescription = "moveProperty"
	}	
}